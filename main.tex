\documentclass[10pt,twoside,openright,dvipdfmx]{jsbook}

%------------------------------%
% geometry
%------------------------------%

%\usepackage[pass,showframe]{geometry}
\usepackage[pass]{geometry}

%------------------------------%
% afterpage
%------------------------------%

\usepackage{afterpage}
\newcommand\blankpage{%
    \null
    \thispagestyle{empty}
    \addtocounter{page}{-1}
    \newpage
}

%------------------------------%
% makeidx
%------------------------------%

\usepackage{imakeidx}
\makeindex
\indexsetup{othercode={\thispagestyle{plain}}}

%------------------------------%
% fancyhdr
%------------------------------%

\usepackage{fancyhdr}

\pagestyle{fancy}
\fancyhf{}
\fancyhead[RO]{\leftmark}
\fancyhead[LE]{\rightmark}
\fancyfoot[LE,RO]{\thepage}
\setlength{\footskip}{12pt}

% TODO: apply beginning pages of chapter
\fancypagestyle{plain}{%
    \fancyhead{}
    \fancyfoot[LE,RO]{\thepage}
}

%------------------------------%
% color
%------------------------------%

\usepackage{color}
%http://www.biwako.shiga-u.ac.jp/sensei/kumazawa/tex/color.html
\input{colors/jpncolor}

%------------------------------%
% graphicx
%------------------------------%

\usepackage{graphicx}

%------------------------------%
% listings
%------------------------------%

\usepackage{listings,jlisting}
\input{languages/swift}
\input{languages/objectivec}

%------------------------------%
% box
%------------------------------%

\usepackage{ascmac,fancybox}

%------------------------------%
% biblatex
%------------------------------%

\usepackage[style=numeric,backend=biber,defernumbers=true]{biblatex}
\addbibresource{bibliographies/apple.bib}
\addbibresource{bibliographies/articles.bib}
\addbibresource{bibliographies/others.bib}

%------------------------------%
% accented letters
%------------------------------%

\usepackage[utf8]{inputenc}

%------------------------------%
% development
%------------------------------%

\usepackage{lipsum}
\usepackage{layout}

%------------------------------%
% title
%------------------------------%

\usepackage{authblk}

\title{%
    先生，まだテスト習ってません(仮) \\
    \large iOSDC2017草稿}
\author[$\dagger$]{しもとりしぐれ}
\affil[$\dagger$]{@S\_Shimotori}
\date{\today}

%------------------------------%
% hyperref
%------------------------------%

\usepackage[colorlinks]{hyperref}

\hypersetup{
    urlcolor=hujinezumi,
    citecolor=sora,
    linkcolor=black
}

\usepackage[normalem]{ulem}

\makeatletter
\begingroup
    \catcode`\$=6
    \catcode`\#=12
    \gdef\href@split$1#$2#$3\\$4{
        \hyper@@link{$1}{$2}{\uline{$4}}
        \endgroup
    }%
\endgroup

%------------------------------%
% document
%------------------------------%

\begin{document}

\newgeometry{hmarginratio=1:1}
\maketitle
\restoregeometry

\afterpage{\blankpage}

\pagenumbering{roman}

\tableofcontents
\thispagestyle{plain}

\chapter*{はしがき}
\thispagestyle{plain}
\addcontentsline{toc}{chapter}{はしがき}
\input{bodies/foreword}

\cleardoublepage
\pagenumbering{arabic}

%------------------------------%
% TODO: delete

\newgeometry{hmarginratio=1:1}
\part{part}
\restoregeometry

\chapter{chapter}
\thispagestyle{plain}
\section{section}
\subsection{subsection}
ほげ\index{ほげ}\cite{hoge}
\marginpar{ほげ}
\chapter{listing}
\thispagestyle{plain}
\begin{lstlisting}[language=swift,caption=キャプション,label=ラベル]
/*
 * comment
 */
func hoge(int: Int) -> String {
    return "int"    // return
}

hoge(100)

struct Point {
    let x: Int
    let y: Float
}
\end{lstlisting}
\begin{lstlisting}[language=objectivec,caption=キャプション,label=ラベル]
#import <Foundation/Foundation.h>
#import <stdio.h>

/*
 * comment
 */
@interface MyClass: NSObject {
}
- (void)myMethod;
@end

@implementation MyClass
- (void)myMethod {
    printf("Hello World.\n");
}
@end
\end{lstlisting}


\newgeometry{hmarginratio=1:1}
\part{part}
\restoregeometry

\chapter{chapter}
\thispagestyle{plain}
\section{section}
\subsection{subsection}

はげ\cite{hage}

\lipsum

\subsection{subsection}

\lipsum

\subsection{subsection}

\lipsum

\subsection{subsection}

\lipsum

%------------------------------%

\printbibheading[heading=bibintoc,title={参考文献}]
\thispagestyle{plain}
\printbibliography[heading=subbibintoc,type=article,title={Articles}]
\printbibliography[heading=subbibintoc,type=book,title={Books}]
\printbibliography[heading=subbibintoc,type=online,title={Onlines}]
\printbibliography[heading=subbibintoc,type=github,title={GitHubs}]

\printindex

\end{document}

